<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-aws/vpc" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">VPC | tech-notes</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/aws/vpc"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="VPC | tech-notes"><meta data-rh="true" name="description" content="Virtual Private Cloud"><meta data-rh="true" property="og:description" content="Virtual Private Cloud"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/aws/vpc"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/aws/vpc" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/aws/vpc" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.7ba8d1d0.css">
<script src="/assets/js/runtime~main.b6662155.js" defer="defer"></script>
<script src="/assets/js/main.358d202d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">tech-notes</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/andreasblaze/tech-notes/tree/main/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="GitHub repository"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path>
            </svg></a><a href="https://www.linkedin.com/in/andrii-bondariev/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Home Page</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/category/aws">AWS</a><button aria-label="Collapse sidebar category &#x27;AWS&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aws/general">General Info</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aws/IAM">IAM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aws/EC2">EC2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aws/networking">Networking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aws/elb-asg">ELB &amp; ASG</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aws/database">Databases</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aws/route53">Route 53</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aws/s3">S3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aws/s3cmd">s3cmd</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aws/cloudfront">CloudFront</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aws/sa-trics">Solutions Architecture Trics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aws/storage-extras">storage-extras</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aws/awscli">AWS CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/aws/vpc">VPC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aws/containers">Containers Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aws/serverless">Serverless</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/terraform">Terraform</a><button aria-label="Expand sidebar category &#x27;Terraform&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/k8s">K8s</a><button aria-label="Expand sidebar category &#x27;K8s&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/linux">Linux</a><button aria-label="Expand sidebar category &#x27;Linux&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/networking">Networking</a><button aria-label="Expand sidebar category &#x27;Networking&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/databases">Databases</a><button aria-label="Expand sidebar category &#x27;Databases&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/docker">Docker</a><button aria-label="Expand sidebar category &#x27;Docker&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/cicd">CI/CD</a><button aria-label="Expand sidebar category &#x27;CI/CD&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/monitoring">Monitoring</a><button aria-label="Expand sidebar category &#x27;Monitoring&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/logging">Logging</a><button aria-label="Expand sidebar category &#x27;Logging&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/scripting">Scripting</a><button aria-label="Expand sidebar category &#x27;Scripting&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/git">Git</a><button aria-label="Expand sidebar category &#x27;Git&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/testing">Testing</a><button aria-label="Expand sidebar category &#x27;Testing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/markdown-usage">Markdown Usage</a><button aria-label="Expand sidebar category &#x27;Markdown Usage&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/category/aws"><span itemprop="name">AWS</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">VPC</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>VPC</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="virtual-private-cloud">Virtual Private Cloud<a href="#virtual-private-cloud" class="hash-link" aria-label="Direct link to Virtual Private Cloud" title="Direct link to Virtual Private Cloud">​</a></h2>
<p>С помощью <strong>VPC</strong> можно запускать ресурсы <strong>AWS</strong> в определенной вами логически изолированной виртуальной сети. Эта виртуальная сеть очень похожа на традиционную сеть, которую вы можете использовать в собственном центре обработки данных, с преимуществами использования масштабируемой инфраструктуры <strong>AWS</strong>.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><strong>VPC</strong> может быть несколько в AWS регионе (максимум 5 на регион, но это софтовое ограничение, так что можно увеличить).</p></div></div>
<p>На следующей диаграмме показан пример <strong>VPC</strong>. <strong>VPC</strong> имеет одну подсеть в каждой из <code>Availability Zones</code> в <code>Region</code>, <strong>EC2</strong> инстансы в каждой подсети и <code>Internet Gateway</code>, обеспечивающий связь между ресурсами вашего <strong>VPC</strong> и Интернетом.</p>
<p><img loading="lazy" alt="AWS VPC Example" src="/assets/images/vpc-example-2675569e7a9fa7e52f9fc852d63028ab.png" width="521" height="311" class="img_ev3q"></p>
<p>VPC Components Diagram:
<img loading="lazy" alt="VPC Components Diagram" src="/assets/images/vpc-components-diagram-c930550d1525cdfdbcc165660d414a0e.png" width="2488" height="1299" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cidr">CIDR<a href="#cidr" class="hash-link" aria-label="Direct link to CIDR" title="Direct link to CIDR">​</a></h2>
<p><strong>Classless Inter-Domain Routing</strong> (<em>бесклассовая междоменная маршрутизация</em>) — это метод выделения <strong>IP</strong>-адресов, который повышает эффективность маршрутизации данных в Интернете. Каждая машина, сервер и устройство конечного пользователя, подключающееся к Интернету, имеют связанный с ним уникальный номер, называемый <strong>IP</strong>-адресом. Устройства находят друг друга и вза имодействуют друг с другом, используя эти <strong>IP</strong>-адреса. Организации используют <strong>CIDR</strong> для гибкого и эффективного распределения <strong>IP</strong>-адресов в своих сетях. Вместо классификации <strong>IP</strong>-адреса на основе классов маршрутизаторы получают адрес сети и хоста, указанный суффиксом <strong>CIDR</strong>.</p>
<p><strong>CIDR</strong> используется в правилах <code>Security Groups</code> (как и AWS networking в целом) и помогает определить ренж <strong>IP</strong> адресов. Например, <em>ww.xx.yy.zz/32</em> =&gt; <code>1</code> <strong>IP</strong>, а <em>0.0.0.0/0</em> =&gt; все <strong>IPs</strong>. Если мы укажем <em>192.168.0.0/26</em> - это будет ренж от <em>192.168.0.0</em> до <em>192.168.0.63</em> (<code>64</code> <strong>IP</strong> адреса).</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Formula</div><div class="admonitionContent_BuS1"><p>/28 means 16 IPs (=2^(32-28) = 2^4)</p></div></div>
<p><strong>CIDR</strong> состоит из двух компонент ов:</p>
<ul>
<li><strong>Base IP</strong>: базовый IP, типо 10.0.0.0, 192.168.0.0 и тд.</li>
<li><strong>Subnet Mask</strong>: определяет сколько можно именить битов в IP (/0, /24, /34).</li>
</ul>
<p><img loading="lazy" alt="CIDR notation" src="/assets/images/CIDR-notation-297fd8c435ed5513bff9f3dfaf2d0fe4.webp" width="655" height="385" class="img_ev3q"></p>
<p><strong>Subnet Mask</strong> в основном позволяет части базового <strong>IP</strong>-адреса получать дополнительные следующие значения из базового <strong>IP</strong>-адреса.</p>
<p><img loading="lazy" alt="CIDR Subnet Mask" src="/assets/images/CIDR_SubnetMask-ffa2f3b1d796ce42abd6ceb4f9deb128.png" width="1344" height="607" class="img_ev3q"></p>
<p><img loading="lazy" alt="CIDR Octets" src="/assets/images/CIDR_Octets-57d745cf4b8a91d3acd6db68eb4c474f.png" width="467" height="452" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Лимиты по <strong>CIDR</strong>:</p><ul>
<li>Min size is /28 (16 IP addresses)</li>
<li>Max size is /16 (65536 IP addresses)</li>
<li>5 IP already reserved by AWS</li>
</ul></div></div>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>Наш <strong>VPC CIDR</strong> не должен пересекаться с другими нашими сетями (корпоративными).</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="public-vs-private-ip">Public vs Private IP<a href="#public-vs-private-ip" class="hash-link" aria-label="Direct link to Public vs Private IP" title="Direct link to Public vs Private IP">​</a></h2>
<p><strong>IANA</strong> (<em>Internet Assigned Numbers Authority</em>) установили определенные блоки адресов <strong>IPv4</strong> для использования частных (<strong>LAN</strong>) и общедоступных (<strong>Интернет</strong>) адресов:</p>
<ul>
<li><strong>Private IP</strong>:<!-- -->
<ul>
<li><em>10.0.0.0</em> - <em>10.255.255.255</em> (<strong>10.0.0.0/8</strong>)</li>
<li><em>172.16.0.0</em> - <em>172.31.255.255</em> (<strong>172.16.0.0/12</strong>) AWS default VPC in that range</li>
<li><em>192.168.0.0</em> - <em>192.168.255.255</em> (<strong>192.168.0.0/16</strong>) home networks</li>
</ul>
</li>
</ul>
<blockquote>
<p>Так как <strong>VPC</strong> - это приватная сеть, то только <code>Private IPv4</code> ренжи могут быть использованы.</p>
</blockquote>
<p>Все остальные ренжи являются <strong>публичными</strong>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="default-vpc-walkthrough">Default VPC Walkthrough<a href="#default-vpc-walkthrough" class="hash-link" aria-label="Direct link to Default VPC Walkthrough" title="Direct link to Default VPC Walkthrough">​</a></h2>
<ul>
<li>Все новые AWS аккаунты имеют дефолтную <strong>VPC</strong>.</li>
<li>Новые <strong>EC2</strong> инстансы запускаются в дефолтной <strong>VPC</strong> если никакая подсеть не была указана.</li>
<li>Дефолтная <strong>VPC</strong> имеет выход в Интернет и все <strong>EC2</strong> инстансы внутри имеют публичные <strong>IPv4</strong>.</li>
<li>Нам доступны публичные и приватные <strong>IPv4</strong> <strong>DNS</strong> имена.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="subnets">Subnets<a href="#subnets" class="hash-link" aria-label="Direct link to Subnets" title="Direct link to Subnets">​</a></h2>
<p>Подсеть - это такой саб-ренж наших <strong>IPv4</strong> адресов внутри нашего <strong>VPC</strong>.</p>
<p>AWS резервирует 5 <strong>IP</strong> адресов (первые 4 и последний 1) в каждой подсети. Например, если <strong>CIDR</strong> block <em>10.0.0.0/24</em>, тогда зарезервируемые <strong>IP</strong> адреса будут следующие:</p>
<ul>
<li><em>10.0.0.0</em> - сетевой адрес</li>
<li><em>10.0.0.1</em> - reserved by AWS, VPC роутер</li>
<li><em>10.0.0.2</em> - reserved by AWS, для маппинга Amazon-provided DNS</li>
<li><em>10.0.0.3</em> - reserved by AWS, для дальнейшего использования</li>
<li><em>10.0.0.255</em> - Network Broadcast Address, хоть AWS в VPC не поддерживает броадкаст, но этот адрес является зарезервированным</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="internet-gateway-igw">Internet Gateway (IGW)<a href="#internet-gateway-igw" class="hash-link" aria-label="Direct link to Internet Gateway (IGW)" title="Direct link to Internet Gateway (IGW)">​</a></h2>
<p><strong>IGW</strong> помогает AWS ресурсам, таким как <strong>EC2</strong> инстансам, выходить в Интернет, находясь в <strong>VPC</strong>. Создается отдельно от <strong>VPC</strong>. К одному <strong>IGW</strong> может быть прикреплена одна <strong>VPC</strong> и наоборот.</p>
<p>По своей сути <strong>IGW</strong> не позволяет выход в Интернет, для этого надо редактировать <code>Route Tables</code> так, чтобы тот же <strong>EC2</strong> инстанс мог законнектиться с роутером и потом законнектиться с <strong>IGW</strong>, а оттуда уже законнектиться с Интернетом.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="bastion-hosts">Bastion Hosts<a href="#bastion-hosts" class="hash-link" aria-label="Direct link to Bastion Hosts" title="Direct link to Bastion Hosts">​</a></h2>
<p>Хост-бастион – это <strong>EC2</strong> инстанс, который действует как безопасный шлюз для доступа к приватным инстансам в среде <strong>VPC</strong>. Это выделенный сервер, обеспечивающий безопасный доступ к ресурсам приватной сети из-за пределов <strong>VPC</strong>. Хост-бастион часто называют <code>jump host</code> или <code>jump server</code>, поскольку он используется для перехода из Интернета в приватную сеть.</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p><code>Bastion Host Security Group</code> должна иметь разрешающее входящее правило (<code>allow inbound</code>) из Интернета на 22-м порту (<strong>SSH</strong>) из ограниченного <strong>CIDR</strong>. Например, публичный <strong>CIDR</strong> компании.</p><p><code>EC2 Security Group</code> должны разрешать <code>Bastion Host Security Group</code> или приватный IP хоста Бастиона.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="nat-instances">NAT Instances<a href="#nat-instances" class="hash-link" aria-label="Direct link to NAT Instances" title="Direct link to NAT Instances">​</a></h2>
<p><strong>NAT</strong> = <em>Network Address Translation</em> - технология, позволяющая <strong>EC2</strong> инстансам в приватных сабнетах коннектиться к Интернету - чтобы это сделать, надо поправить <code>Route Tables</code> так, чтобы роутить траффик из приватной сабнеты к <code>NAT Instance</code>.</p>
<p><strong>NAT</strong> инстанс должен быть запущенным в публичной сабнете и иметь <code>Elastic IP</code> (<strong>EIP</strong>).</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><code>Source/Destination Checking</code> должно быть отключено на NAT инстансе, так как ем у надо отправлять и получать сорс и дистенейшен не его собственный.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="nat-gateway">NAT Gateway<a href="#nat-gateway" class="hash-link" aria-label="Direct link to NAT Gateway" title="Direct link to NAT Gateway">​</a></h2>
<p><code>NAT Gateway</code> - это AWS-managed <strong>NAT</strong> с более высокой пропускной способностью (<em>from 5 Gbps to 100 Gbps</em>), высокой доступностью и отсутствием администрирования. Платится за каждый час использования и пропускной способности.</p>
<p>Создается в определенной <code>Availability Zone</code> и используется <code>Elastic IP</code>.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Необходим <strong>IGW</strong> (<em>Internet Gateway</em>) для роутинга с приватной сабнеты на <code>NAT Gateway</code> и потом в Интернет.</p><p>No <code>Security Groups</code> to manage / required.</p><p>1 <code>NAT Gateway</code> per 1 <code>Availability Zone</code>. Для <code>Fault-Tolerance</code> надо делать несколько <code>NATGW</code> в нескольких <code>AZ</code>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="security-groups--nacls">Security Groups &amp; NACLs<a href="#security-groups--nacls" class="hash-link" aria-label="Direct link to Security Groups &amp; NACLs" title="Direct link to Security Groups &amp; NACLs">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><code>Security group</code> - это фаервол для <strong>EC2 Instances</strong>. <code>Security group</code> является <strong>stateful</strong>: при <em>inbound</em> правиле - автоматически создается соответствующее <em>outbound</em> правило, автоматически разрешается обратный траффик после установки соединения.</p><p><em>Network Access Control List</em> (<code>NACL</code>) - это фаервол для <strong>VPC Subnets</strong>. <code>NACL</code> является <strong>stateless</strong>: требует явных правил как для <em>inbound</em>, так и для <em>outbound</em> трафика и каждое правило контролирует либо <em>inbound</em>, либо <em>outbound</em> трафик, и нет автоматического разрешения обратного трафика, как в <strong>stateful</strong> <code>Security group</code>.</p></div></div>
<p><code>Security Groups</code> и <code>NACLs</code> схожи тем, что позволяют контролировать доступ к ресурсам <strong>AWS</strong> в <code>VPC</code>. Но <code>Security Groups</code> позволяют контролировать входящий (<em>inbound</em>) и исходящий трафик (<em>outbound</em>) на уровне EC2 инстанса, тогда как <code>NACLs</code> предлагают ана логичные возможности на уровне подсети <strong>VPC</strong>.</p>
<p><img loading="lazy" alt="Security Group and NACL" src="/assets/images/vpc-sg-nacl-191d835126169b315dcf7c37fe1cd41c.webp" width="720" height="614" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="network-access-control-list-nacl">Network Access Control List* (NACL)<a href="#network-access-control-list-nacl" class="hash-link" aria-label="Direct link to Network Access Control List* (NACL)" title="Direct link to Network Access Control List* (NACL)">​</a></h3>
<p><strong>NACL</strong> имеет правила от 1 до 32766, где более высокий приоритет с меньшим номером. Первое совпадение правил будет определять решение:</p>
<blockquote>
<p>Если мы определим <code>#100 ALLOW 10.0.0.10/32</code> и <code>#200 DENY 10.0.0.10/32</code>, то IP адрес будет разрешен, так как #100 выше по приоритету, чем #200.</p>
</blockquote>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>Новосозданные <code>NACLs</code> будут все запрещать по умолчанию.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="default-nacl">Default NACL<a href="#default-nacl" class="hash-link" aria-label="Direct link to Default NACL" title="Direct link to Default NACL">​</a></h3>
<p>Принимает все входящие/исходящие сообщ ения из подсетей, с которыми он связан.
<img loading="lazy" alt="Default NACL" src="/assets/images/vpc-default-nacl-216ccaa927aff646f6cba768c8b50b75.png" width="1331" height="465" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ephemeral-ports">Ephemeral Ports<a href="#ephemeral-ports" class="hash-link" aria-label="Direct link to Ephemeral Ports" title="Direct link to Ephemeral Ports">​</a></h3>
<p><strong>Ephemeral Ports</strong> или* Эфемерные порты* - это рандомно выбранные порты на ОС для создания запроса, чтобы в пакете, содержащий запрос, был соответствующий параметр про порт для установки соединения.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="vpc-peering">VPC Peering<a href="#vpc-peering" class="hash-link" aria-label="Direct link to VPC Peering" title="Direct link to VPC Peering">​</a></h2>
<p><strong>VPC Peering Connection</strong> — это сетевое соединение между двумя <strong>VPC</strong>, которое позволяет маршрутизировать трафик между ними с использованием приватных адресов IPv4 или IPv6. Инстансы в любом <strong>VPC</strong> могут взаимодействовать друг с другом, как если бы они находились в одной сети.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>В ходе коммуникующих между собой <strong>VPC</strong>&#x27;s, стоит назначать разные <strong>CIDR</strong>&#x27;s, чтобы не было оверлаппинга.</p><p><strong>VPC Peering Connection</strong> можно создать для <strong>VPC</strong>&#x27;s, что находятся в разных аккаунтах или регионах.</p><p>Можно использовать <code>Security group</code> как референс после пиринга.</p></div></div>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>Нужно обновить <code>Route Tables</code> в каждой <strong>VPC</strong> сабнете, чтобы <strong>EC2</strong> инстансы могли коммуницировать между собой.</p></div></div>
<p><img loading="lazy" alt="VPC Peering" src="/assets/images/vpc-peering-c6901d9e628bbe4a136b820acf110220.png" width="711" height="743" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="vpc-endpoints">VPC Endpoints<a href="#vpc-endpoints" class="hash-link" aria-label="Direct link to VPC Endpoints" title="Direct link to VPC Endpoints">​</a></h2>
<p><strong>VPC Endpoint</strong> позволяет приватно законнектить <strong>VPC</strong> к поддерживаемым сервисам <strong>AWS</strong> и <strong>VPC Endpoints</strong> сервисам на базе <code>PrivateLink</code> без необходимости использования интернет-шлюза, устройства <strong>NAT</strong>, <strong>VPN</strong>-соединения или соединения <strong>AWS Direct Connect</strong>.</p>
<p><img loading="lazy" alt="VPC Endpoint Example" src="/assets/images/vpc-endpoints-example-1-7229ed7fa4d81840229741bfd6aeb0bd.png" width="531" height="483" class="img_ev3q"></p>
<blockquote>
<p><strong>Пример</strong>: у нас есть публичная сабнета с <strong>NAT Gateway</strong> и <strong>EC2</strong> инстансом для выхода в интернет через <strong>Internet Gateway</strong>, и приватная сабнета с <strong>EC2</strong> инстансом. <strong>EC2</strong> инстанс должен коммуницировать с <strong>AWS SNS</strong> сервисом и для этого ему надо пройти через <strong>NAT Gateway</strong> и <strong>Internet Gateway</strong>, так как необходим публичный доступ. <strong>EC2</strong> инстансу так-то тоже надо идти через <strong>Internet Gateway</strong>, чтобы иметь доступ к <strong>AWS SNS</strong>.</p>
</blockquote>
<p>Этот пример имеет право на существование, но его можно оптимизировать с помощью <strong>VPC Endpoints</strong> для уменьшения костов на траффик через <strong>NAT Gateway</strong> и <strong>Internet Gateway</strong>(бесплатно, но есть задержка).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="types-of-endpoints">Types of Endpoints<a href="#types-of-endpoints" class="hash-link" aria-label="Direct link to Types of Endpoints" title="Direct link to Types of Endpoints">​</a></h3>
<ul>
<li><strong>Interface Endpoints</strong> (<em>powered by PrivateLink</em>): Предоставляет <strong>ENI</strong> (приватный <strong>IP</strong> адрес) в качестве точки входа. Для этого действия, нам над прикрепить <strong>Security Group</strong>. Кост насчитывается за каждый час + за каждый гигабайт обработанных данных.</li>
<li><strong>Gateway Endpoints</strong>: Предоставляет шлюз и это необходимо использовать в качестве таргета в <strong>Route Tables</strong>. Таким образом, это не использует <strong>IP</strong>-адреса, <strong>Security Group</strong>, это просто таргет в <strong>Route Tables</strong>. И для ендпоинта шлюза есть только два таргета: <code>Amazon S3</code> и <code>DynamoDB</code>, но преимущество что это бесплатно и автоматически масштабируется.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Для <code>Amazon S3</code> и <code>DynamoDB</code> лучше заморочиться с <strong>Route Tables</strong> и использовать <strong>Gateway Endpoints</strong>, так как это бесплатно и более ефективно.</p><p>Для <strong>Interface Endpoints</strong> требуется ли предпочтительный доступ из on-premises среды (Site-to-Site VPN или DirectConnect), другого VPC или другого региона.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="vpc-flow-logs">VPC Flow Logs<a href="#vpc-flow-logs" class="hash-link" aria-label="Direct link to VPC Flow Logs" title="Direct link to VPC Flow Logs">​</a></h2>
<p><strong>VPC Flow Logs</strong> - это функция, которая позволяет собирать информацию об входящем и исходящем <strong>IP</strong>-трафике от сетевых интерфейсов в вашем <strong>VPC</strong>. <strong>VPC Flow Logs</strong> можно публиковать в <code>Amazon CloudWatch Logs</code>, <code>Amazon S3</code> или <code>Amazon Data Firehose</code>.</p>
<p>Есть три типа <strong>Flow Logs</strong>:</p>
<ul>
<li><strong>VPC</strong></li>
<li><strong>Subnet</strong></li>
<li><strong>ENI</strong></li>
</ul>
<p><img loading="lazy" alt="VPC Flow Logs Syntax" src="/assets/images/vpc-flow-logs-syntax-d96b08a1215625330a5cdcbeac44f9f6.png" width="1241" height="199" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="site-to-site-vpn-virtual-private-gateway--customer-gateway">Site-to-Site VPN, Virtual Private Gateway &amp; Customer Gateway<a href="#site-to-site-vpn-virtual-private-gateway--customer-gateway" class="hash-link" aria-label="Direct link to Site-to-Site VPN, Virtual Private Gateway &amp; Customer Gateway" title="Direct link to Site-to-Site VPN, Virtual Private Gateway &amp; Customer Gateway">​</a></h2>
<p><img loading="lazy" alt="Site-to-Site VPN" src="/assets/images/vpc-side-to-side-vpn-1d94b96300c34f320b214aabff02f391.png" width="430" height="681" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>Если нужно выполнить ping инстансов <strong>EC2</strong> из среды <em>on-premises</em> в AWS, убедитесь, что протокол <strong>ICMP</strong> включен в inbound правило в <strong>Security Group</strong>.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="site-to-site-vpn">Site-to-Site VPN<a href="#site-to-site-vpn" class="hash-link" aria-label="Direct link to Site-to-Site VPN" title="Direct link to Site-to-Site VPN">​</a></h3>
<p><strong>Site-to-Site VPN</strong> подключает <em>on-premises</em> сеть к AWS <strong>VPC</strong> через <strong>VPN</strong>-подключение <strong>IPsec</strong>. Этот тип VPN позволяет вашим ресурсам AWS безопасно взаимодействовать с вашими локальными ресурсами, как если бы они находились в одной сети (безопасное соединение между вашей корпоративной сетью и AWS <strong>VPC</strong>).</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Чтобы настроить <strong>Site-to-Site VPN</strong> между <em>on-premises</em> и AWS, нужно сначала создать <strong>Customer Gateway</strong>, потом <strong>Virtual Private Gateway</strong> и связать их в <strong>Site-to-Site VPN</strong>.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="virtual-private-gateway-vgw">Virtual Private Gateway (VGW)<a href="#virtual-private-gateway-vgw" class="hash-link" aria-label="Direct link to Virtual Private Gateway (VGW)" title="Direct link to Virtual Private Gateway (VGW)">​</a></h3>
<p><strong>Virtual Private Gateway</strong> — это VPN-концентратор на стороне Amazon <strong>Site-to-Site VPN</strong>. Это ендпоинт вашего <strong>VPN</strong>-соединения на стороне AWS. Когда вы создаете <strong>Site-to-Site VPN</strong>, вы подключаете <strong>Virtual Private Gateway</strong> к своему <strong>VPC</strong>.</p>
<blockquote>
<p>У вас есть <strong>VPC</strong>, где вы размещаете несколько <strong>EC2</strong> инстансов, на которых работают различные приложения. Чтобы подключить этот <strong>VPC</strong> к вашей локальной сети через <strong>VPN</strong>, вы создаете и подключаете <strong>Virtual Private Gateway</strong> к своему <strong>VPC</strong>.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="customer-gateway-cgw">Customer Gateway (CGW)<a href="#customer-gateway-cgw" class="hash-link" aria-label="Direct link to Customer Gateway (CGW)" title="Direct link to Customer Gateway (CGW)">​</a></h3>
<p><strong>Customer Gateway</strong> — это ресурс, который предоставляет AWS информацию об устройстве клиентского шлюза или программном приложении в вашей локальной сети. По сути, это конфигурация на вашей стороне, которая сообщает AWS настройки вашего <strong>VPN</strong>-устройства.</p>
<blockquote>
<p>В вашем <em>on-premises</em> датацентре может быть установлено <strong>VPN</strong>-устройство (например, <code>Cisco ASA</code>, <code>Juniper SRX</code> или VPN-решение с открытым исходным кодом). При настройке <strong>Site-to-Site VPN</strong> в AWS вы должны создать <strong>Customer Gateway</strong> в AWS, предоставив такие данные, как <code>общедоступный IP-адрес</code> вашего <strong>VPN</strong>-устройства и информацию о маршрутизации.</p>
</blockquote>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Таким образом, вы можете использовать <strong>Direct Connect</strong> в качестве вторичного соединения, но это будет довольно дорого. Или вы можете настроить <strong>VPN</strong>-соединение <strong>Site-to-Site</strong> в качестве резервного соединения и настроить его так, чтобы в случае сбоя основного соединения оно сработало, и теперь вы подключаетесь через общедоступный Интернет, используя <strong>VPN</strong>-соединение <strong>Site-to-Site</strong>, что может быть немного надежнее, потому что Интернет, общедоступный Интернет, всегда может быть доступен.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="aws-vpn-cloudhub">AWS VPN CloudHub<a href="#aws-vpn-cloudhub" class="hash-link" aria-label="Direct link to AWS VPN CloudHub" title="Direct link to AWS VPN CloudHub">​</a></h3>
<p>Идея состоит в том, что у вас есть <strong>VPC</strong> с вашим <strong>VGW</strong>, и у вас есть несколько клиентских сетей, несколько датацентров, каждый со своим собственным <strong>CGW</strong>. Таким образом, <strong>CloudHub</strong> должен обеспечить безопасную связь между всеми этими сайтами, используя несколько <strong>VPN</strong>-соединений.</p>
<p>Это недорогая звездообразная модель для первичного или вторичного сетевого подключения между разными местоположениями, но только с использованием <strong>VPN</strong>. Таким образом, вы должны установить межсетьевую <strong>VPN</strong> между <strong>CGW</strong> и одним <strong>VGW</strong> в вашем <strong>VPC</strong>. И затем, благодаря этому соединению, сети ваших клиентов теперь могут взаимодействовать друг с другом через это <strong>VPN</strong>-соединение.
<img loading="lazy" alt="VPC CloudHub" src="/assets/images/vpc-cloudhub-cecd4560d0731587e8d12b81aa2a0847.png" width="972" height="773" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="direct-connect--direct-connect-gateway">Direct Connect &amp; Direct Connect Gateway<a href="#direct-connect--direct-connect-gateway" class="hash-link" aria-label="Direct link to Direct Connect &amp; Direct Connect Gateway" title="Direct link to Direct Connect &amp; Direct Connect Gateway">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="direct-connect-dx">Direct Connect (DX)<a href="#direct-connect-dx" class="hash-link" aria-label="Direct link to Direct Connect (DX)" title="Direct link to Direct Connect (DX)">​</a></h3>
<p><strong>Direct Connect (DX)</strong> дает увеличенную пропускную способность, а это означает, что если вы работаете с большими наборами данных, это будет быстрее, потому что они не проходят через общедоступный Интернет, а также у вас будут меньшие затраты, потому что вы вы используете приватное соединение.</p>
<p>Кроме того, если у вас возникли проблемы с подключением к общедоступному Интернету, мы воспользуемся <strong>Direct Connect</strong>, чтобы получить более стабильную работу в сети, опять же, потому что она является приватной. Это особенно полезно, если у вас есть приложения, использующие каналы данных в реальном времени. Наконец, он поддерживает гибридные среды, поскольку у вас есть возможность подключения между собственным датацентром и облаком.</p>
<ul>
<li>Обеспечивает выделенное приватное соединение из удаленной сети с вашим <strong>VPC</strong>.</li>
<li>Между вашим DC и местоположениями AWS <code>Direct Connect</code> должно быть установлено выделенное соединение.</li>
<li>Вам необходимо настроить <strong>Virtual Private Gateway</strong> на вашем <strong>VPC</strong>.</li>
<li>Доступ к общедоступным ресурсам (<strong>S3</strong>) и частным ресурсам (<strong>EC2</strong>) по одному и тому же соединению.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Используя соединение <strong>Direct Connect</strong>, вы можете получить доступ как к <code>Public</code>, так и к <code>Private</code> ресурсам AWS.</p></div></div>
<p><img loading="lazy" alt="VPC DirectConnect Diagram" src="/assets/images/vpc-direct-connect-diagram-4c82ec5116092a90405f484511f51394.png" width="1736" height="818" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="direct-connect-gateway">Direct Connect Gateway<a href="#direct-connect-gateway" class="hash-link" aria-label="Direct link to Direct Connect Gateway" title="Direct link to Direct Connect Gateway">​</a></h3>
<p><strong>Direct Connect Gateway</strong> используется, если нужно подключиться к одному или нескольким <strong>VPC</strong> в разных регионах.</p>
<p><img loading="lazy" alt="VPC DirectConnect Gateway Diagram" src="/assets/images/vpc-direct-connect-gateway-diagram-955c01346ab455d6571b1402222aa732.png" width="1404" height="616" class="img_ev3q"></p>
<blockquote>
<p><strong>Пример</strong>: у нас есть два региона, и у них есть два разных <strong>VPC</strong>, у нас есть два разных <strong>CIDR</strong>, и мы хотим подключить наш <em>on-premises</em> датацентр к обоим <strong>VPC</strong>. Итак, мы собираемся установить соединение <strong>Direct Connect</strong>, а затем, используя приватный <strong>Virtual Interface</strong>, вы подключите его к <strong>Direct Connect Gateway</strong>. И этот <strong>Direct Connect Gateway</strong> будет иметь приватный <strong>Virtual Interface</strong> с <strong>Virtual Private Gateway</strong> в первом регионе и еще одним во втором регионе. Итак, используя настройку, мы можем начать подключаться к нескольким <strong>VPC</strong> и нескольким регионам.</p>
</blockquote>
<p>Connection Types:</p>
<ul>
<li><strong>Dedicated Connections</strong>: 1 Gbps, 10 Gbps и 100 Gbps;</li>
</ul>
<blockquote>
<p>и мы получаем выделенный для нас физический порт <strong>Ethernet</strong>. И сначала нам нужно сделать запрос в AWS, а затем его выполнит партнер <code>AWS Direct Connect</code>.</p>
</blockquote>
<ul>
<li><strong>Hosted Connections</strong>: 50 Mbps, 500 Mbps, да 10 Gbps.</li>
</ul>
<blockquote>
<p>И снова мы делаем запросы на подключение через партнеров <code>AWS Direct Connect</code>. И тогда мы сможем добавлять мощности <em>on-demand</em>.</p>
</blockquote>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Установка подобного соединения составляет обычно более одного месяца по времени - это не быстро.</p></div></div>
<p><strong>AWS Direct Connect</strong> можно использовать в связке с VPN для шифрования через протокол <strong>IPsec</strong> траффика. По умолчанию, <strong>AWS Direct Connect</strong> не зашифрован, но приватен.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="resiliency">Resiliency<a href="#resiliency" class="hash-link" aria-label="Direct link to Resiliency" title="Direct link to Resiliency">​</a></h3>
<p>Итак, в первом случае у нас есть приватный <strong>Virtual Interface</strong> здесь и здесь есть приватный <strong>Virtual Interface</strong>. Итак, здесь мы получаем одно соединение и несколько мест, и поэтому, если одно из мест <strong>Direct Connect</strong> выходит из строя, то, по крайней мере, у нас есть резервное расположение <strong>Direct Connect</strong> где-то еще, и это дает нам высокую отказоустойчивость, и это хорошо для критических рабочих нагрузок.</p>
<p>Но если вы хотите добиться <strong>максимальной</strong> отказоустойчивости для критически важных рабочих нагрузок, тогда вам придется снова настроить два местоположения <strong>Direct Connect</strong>, но на этот раз каждое местоположение <strong>Direct Connect</strong> будет иметь два независимых соединения, чтобы обеспечить максимальную отказоустойчивость. Итак, в этом варианте использования у нас есть четыре соединения в двух местах с AWS. Таким образом, максимальная отказоустойчивость достигается за счет использования отдельных соединений, завершающихся на отдельных устройствах в более чем одном месте.
<img loading="lazy" alt="VPC DirectConnect Resiliency" src="/assets/images/vpc-direct-connect-resiliency-e73f9d4af3fab854a874bc00621aac2a.png" width="1709" height="811" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="transit-gateway">Transit Gateway<a href="#transit-gateway" class="hash-link" aria-label="Direct link to Transit Gateway" title="Direct link to Transit Gateway">​</a></h2>
<p>Для создания транзитного пирингового соединение между тысячами <strong>VPC</strong>, нашим <em>on-premises</em> датацентром, <strong>VPN</strong> типа «сеть-сеть», прямые соединения в звездообразном соединении <code>«звезда»</code>.</p>
<ul>
<li>Это региональный ресурс, который может работать в разных регионах, и вы можете использовать свой транзитный шлюз для нескольких учетных записей с помощью <code>Resource Access Manager</code>(RAM).</li>
<li>Вы также можете использовать пиринговые транзитные шлюзы по всему региону.</li>
<li>Нужно создать таблицы маршрутов для вашего транзитного шлюза, чтобы ограничить, какой <strong>VPC</strong> может взаимодействовать с другим, какое соединение имеет доступ друг к другу и так далее. Таким образом, вы получаете полный контроль над маршрутизацией всего трафика внутри транзитного шлюза, что обесп ечивает сетевую безопасность.</li>
<li><strong>Transit Gateway</strong> работает с <code>Direct Connect Gateway</code> и <strong>VPN</strong>-соединениями.</li>
<li>Это единственный сервис в AWS, который поддерживает многоадресную рассылку IP (<code>IP Multicast</code>).</li>
</ul>
<p>Еще один вариант использования <strong>Transit Gateway</strong> — увеличение пропускной способности <strong>VPN</strong>-подключения типа «сеть-сеть» с помощью <strong>ECMP</strong>. <strong>ECMP</strong> означает многопутевую маршрутизацию с равной стоимостью. Это стратегия маршрутизации, позволяющая пересылать пакеты по нескольким лучшим маршрутам. И вариант использования заключается в создании нескольких <strong>VPN</strong>-подключений типа «сеть-сеть» для увеличения пропускной способности вашего подключения к AWS с использованием <strong>VPN</strong> типа «сеть-сеть».</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Вы хотите увеличить пропускную способность VPN-подключения <strong>AWS Site-to-Site</strong>, установленного между <em>on-premises</em> и облаком AWS, з а пределы максимального предела одного туннеля <strong>IPsec</strong> в 1,25 Гбит/с — используйте <strong>Transit Gateway</strong>.</p></div></div>
<p><img loading="lazy" alt="VPC Transit Gateway" src="/assets/images/vpc-transit-gateway-199ab7ea781c35e2c03f23049fa21f07.png" width="1638" height="786" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="vpc-traffic-mirroring">VPC Traffic Mirroring<a href="#vpc-traffic-mirroring" class="hash-link" aria-label="Direct link to VPC Traffic Mirroring" title="Direct link to VPC Traffic Mirroring">​</a></h2>
<p>Идея состоит в том, что мы хотим ловить и проверять сетевой трафик в нашей <strong>VPC</strong>, но делать это ненавязчиво. Для этого мы хотим направить трафик на устройства безопасности, которыми мы управляем. И для этого мы собираемся перехватить трафик, поэтому мы собираемся определить, из каких исходных <strong>ENI</strong> мы хотим захватывать трафик. А затем цели, куда мы хотим отправить этот трафик: наши собственные <strong>ENI</strong> или, возможно, <code>Network Load Balancer</code>(NLB).</p>
<p><img loading="lazy" alt="VPC Traffic Mirroring" src="/assets/images/vpc-traffic-mirroring-5c55d9590d66ecb39b3f6f191d7d06b4.png" width="529" height="715" class="img_ev3q"></p>
<blockquote>
<p>У нас есть <strong>EC2</strong> и <strong>ENI</strong>. Наш <strong>EC2</strong> подключается к Интернету. Таким образом, мы получаем много входящего и исходящего трафика по <strong>ENI</strong> к <strong>EC2</strong>. Но мы хотели проанализировать наш трафик. Для этого мы собираемся настроить <strong>NLB</strong>, а за этим балансировщиком сетевой нагрузки у нас будет группа автоматического масштабирования (<strong>ASG</strong>) <strong>EC2</strong> инстансов, на которой будет установлено некоторое программное обеспечение безопасности. Теперь мы хотим иметь возможность перехватывать весь трафик из источника <code>A</code>, не нарушая работу. Для этого мы собираемся настроить <code>зеркалирование трафика</code> <strong>VPC</strong> и, при желании, мы можем установить фильтр, чтобы вы получили только некоторую информацию, а не всю. А благодаря этой функции зеркалирования трафика весь трафик, отправленный в <strong>ENI</strong> или источник <code>A</code>, также будет отправлен в наш <strong>NLB</strong>. Отсюда и название нашего <strong>NLB</strong> — зеркалирование трафика. И оттуда мы можем анализировать сам трафик. И это касается не только одного источника, но и нескольких источников.</p>
</blockquote>
<p>Если у вас есть второй <strong>EC2</strong> с другим <strong>ENI</strong>, мы снова можем зеркально отразить трафик в нашем <strong>NLB</strong>. Нам необходимо, чтобы источник и таргет находились в одной <strong>VPC</strong> или в разных <strong>VPC</strong>, и если мы включили <code>VPC Peering</code>. Таким образом, варианты использования зеркалирования трафика <strong>VPC</strong> будут связаны с проверкой контента, мониторингом угроз или устранением неполадок с точки зрения сети.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="egress-gateway">Egress Gateway<a href="#egress-gateway" class="hash-link" aria-label="Direct link to Egress Gateway" title="Direct link to Egress Gateway">​</a></h2>
<p>Фича доступная для IPv6 траффика, а именно разрешение на отдачу, но отказ на прием траффика на <strong>EC2</strong> IPv6.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="networking-costs-per-gb">Networking Costs (per Gb)<a href="#networking-costs-per-gb" class="hash-link" aria-label="Direct link to Networking Costs (per Gb)" title="Direct link to Networking Costs (per Gb)">​</a></h2>
<ul>
<li>Публичный траффик, который заходит из Интернета в наш <strong>EC2</strong>, обходится нам бесплатно.</li>
<li>Траффик внутри <strong>AZ</strong> между <strong>EC2</strong> по <code>Private IP</code> бесплатен.</li>
<li>Если нам нужна коммуникация с <strong>EC2</strong> из другой <strong>AZ</strong> и нам надо будет уже использовать <code>Public IP/Elastic IP</code> и это будет стоить <code>$0.02</code>.</li>
<li>Если ^эта^ коммуникация будет происходить через <code>Private IP</code>, то стоимость будет <code>$0.01</code>.</li>
<li>Траффик между <strong>EC2</strong> в разных регионах будет нам стоить в <code>$0.02</code>.
<img loading="lazy" alt="Networking Costs 1" src="/assets/images/networking-costs-1-662f5a066dc1a2e979731f66eb1c46b0.png" width="1277" height="682" class="img_ev3q"></li>
</ul>
<p>Нужно стараться сохранить как можно больше интернет-трафика в AWS, чтобы минимизировать затраты:
<img loading="lazy" alt="Networking Costs 2" src="/assets/images/networking-costs-2-54db605ebccd6511c85836723eb21337.png" width="1137" height="763" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="s3">S3<a href="#s3" class="hash-link" aria-label="Direct link to S3" title="Direct link to S3">​</a></h3>
<ul>
<li>Траффик, который идет на <strong>S3</strong> - бесплатен, т.к. это <em>ingress</em> траффик.</li>
<li>Стоимость скачивания данных составляет <code>$0.09</code>, т.к. это <em>egress</em> траффик.</li>
<li>Если мы используем <strong>S3 Transfer Acceleration</strong> (ускоряет передачу контента из S3), то это добавит к базе <code>$0.09</code> + <code>$0.04</code>-<code>$0.08</code> за Гб.</li>
<li>Траффик из <strong>S3</strong> в <strong>CloudFront</strong> - бесплатен. Но из <strong>CloudFront</strong> в Интернет будет стоить <code>$0.085</code> за Гб (дешевле, чем <strong>S3</strong>). *Запросы на <strong>CloudFront</strong> в 7 раз дешевле, чем если они совершаются напрямую на <strong>S3</strong>.</li>
<li><strong>S3 Cross Region Replication</strong> обойдется в <code>$0.02</code> за Гб.</li>
</ul>
<blockquote>
<p><strong>Пример</strong>: Есть два <strong>EC2</strong> инстанса в одном регионе, одной <strong>VPC</strong>. Один находится в <code>Private Subnet 1</code>, другой в <code>Private Subnet 2</code>. Оба должны иметь доступ на операции с <strong>S3</strong>. Тот, что в <code>Private Subnet 1</code>, делает это с помощью <strong>NAT Gateway</strong> в <code>Public subnet</code> и с доступом в Интернет через <code>Internet Gateway</code>. Устанавливаем роутинг через <strong>Route Table</strong> для <code>Subnet 1</code>. Другой <strong>EC2</strong> в <code>Private Subnet 2</code> делает обращения к <strong>S3</strong> через <strong>VPC Endpoint</strong> приватным образом. Устанавливаем роутинг через <strong>Route Table</strong> для <code>Subnet 2</code>.</p>
</blockquote>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Private Subnet 1</div><div class="admonitionContent_BuS1"><ul>
<li><code>$0.045</code> <strong>NAT Gateway</strong> / hour</li>
<li><code>$0.045</code> за каждый обработанный Гб на <strong>NAT Gateway</strong></li>
<li><code>$0.09</code> за отправку данных на <strong>S3</strong> из другого региона и <code>$0.00</code> если этот тот же самый регион</li>
</ul></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Private Subnet 2</div><div class="admonitionContent_BuS1"><ul>
<li>Использование Gateway Endpoint - бесплатное</li>
<li><code>$0.01</code> за передачу данных in/out для того же региона</li>
</ul></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="aws-network-firewall">AWS Network Firewall<a href="#aws-network-firewall" class="hash-link" aria-label="Direct link to AWS Network Firewall" title="Direct link to AWS Network Firewall">​</a></h2>
<p>Это управляемый сетевой фаервол с отслеживанием состояния, а также сервис по обнаружению и предотвращению вторжений для <strong>VPC</strong>. Предотвращение аттак производится от <code>3</code>-го слоя <strong>OSI</strong> до <code>7</code>-го слоя.
<img loading="lazy" alt="Network Firewall" src="/assets/images/vpc-network-firewall-8605db64e56e762b75c7e6d7f271e035.png" width="803" height="807" class="img_ev3q"></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/aws/awscli"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">AWS CLI</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/aws/containers"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Containers Management</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#virtual-private-cloud" class="table-of-contents__link toc-highlight">Virtual Private Cloud</a></li><li><a href="#cidr" class="table-of-contents__link toc-highlight">CIDR</a></li><li><a href="#public-vs-private-ip" class="table-of-contents__link toc-highlight">Public vs Private IP</a></li><li><a href="#default-vpc-walkthrough" class="table-of-contents__link toc-highlight">Default VPC Walkthrough</a></li><li><a href="#subnets" class="table-of-contents__link toc-highlight">Subnets</a></li><li><a href="#internet-gateway-igw" class="table-of-contents__link toc-highlight">Internet Gateway (IGW)</a></li><li><a href="#bastion-hosts" class="table-of-contents__link toc-highlight">Bastion Hosts</a></li><li><a href="#nat-instances" class="table-of-contents__link toc-highlight">NAT Instances</a></li><li><a href="#nat-gateway" class="table-of-contents__link toc-highlight">NAT Gateway</a></li><li><a href="#security-groups--nacls" class="table-of-contents__link toc-highlight">Security Groups &amp; NACLs</a><ul><li><a href="#network-access-control-list-nacl" class="table-of-contents__link toc-highlight">Network Access Control List* (NACL)</a></li><li><a href="#default-nacl" class="table-of-contents__link toc-highlight">Default NACL</a></li><li><a href="#ephemeral-ports" class="table-of-contents__link toc-highlight">Ephemeral Ports</a></li></ul></li><li><a href="#vpc-peering" class="table-of-contents__link toc-highlight">VPC Peering</a></li><li><a href="#vpc-endpoints" class="table-of-contents__link toc-highlight">VPC Endpoints</a><ul><li><a href="#types-of-endpoints" class="table-of-contents__link toc-highlight">Types of Endpoints</a></li></ul></li><li><a href="#vpc-flow-logs" class="table-of-contents__link toc-highlight">VPC Flow Logs</a></li><li><a href="#site-to-site-vpn-virtual-private-gateway--customer-gateway" class="table-of-contents__link toc-highlight">Site-to-Site VPN, Virtual Private Gateway &amp; Customer Gateway</a><ul><li><a href="#site-to-site-vpn" class="table-of-contents__link toc-highlight">Site-to-Site VPN</a></li><li><a href="#virtual-private-gateway-vgw" class="table-of-contents__link toc-highlight">Virtual Private Gateway (VGW)</a></li><li><a href="#customer-gateway-cgw" class="table-of-contents__link toc-highlight">Customer Gateway (CGW)</a></li><li><a href="#aws-vpn-cloudhub" class="table-of-contents__link toc-highlight">AWS VPN CloudHub</a></li></ul></li><li><a href="#direct-connect--direct-connect-gateway" class="table-of-contents__link toc-highlight">Direct Connect &amp; Direct Connect Gateway</a><ul><li><a href="#direct-connect-dx" class="table-of-contents__link toc-highlight">Direct Connect (DX)</a></li><li><a href="#direct-connect-gateway" class="table-of-contents__link toc-highlight">Direct Connect Gateway</a></li><li><a href="#resiliency" class="table-of-contents__link toc-highlight">Resiliency</a></li></ul></li><li><a href="#transit-gateway" class="table-of-contents__link toc-highlight">Transit Gateway</a></li><li><a href="#vpc-traffic-mirroring" class="table-of-contents__link toc-highlight">VPC Traffic Mirroring</a></li><li><a href="#egress-gateway" class="table-of-contents__link toc-highlight">Egress Gateway</a></li><li><a href="#networking-costs-per-gb" class="table-of-contents__link toc-highlight">Networking Costs (per Gb)</a><ul><li><a href="#s3" class="table-of-contents__link toc-highlight">S3</a></li></ul></li><li><a href="#aws-network-firewall" class="table-of-contents__link toc-highlight">AWS Network Firewall</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 AndreasBlaze, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>