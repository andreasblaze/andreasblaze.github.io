"use strict";(self.webpackChunktech_notes=self.webpackChunktech_notes||[]).push([[5629],{4711:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"ansible/general","title":"Concepts","description":"Ansible Roles","source":"@site/docs/ansible/general.md","sourceDirName":"ansible","slug":"/ansible/general","permalink":"/ansible/general","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Ansible","permalink":"/category/ansible"},"next":{"title":"Testing","permalink":"/category/testing"}}');var i=s(4848),a=s(8453);const r={},t="Concepts",o={},c=[{value:"Ansible Roles",id:"ansible-roles",level:2},{value:"Installing Ansible Roles",id:"installing-ansible-roles",level:2},{value:"Prepare SSH Key for Ansible",id:"prepare-ssh-key-for-ansible",level:2},{value:"Execute Ansible Playbook",id:"execute-ansible-playbook",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"concepts",children:"Concepts"})}),"\n",(0,i.jsx)(n.h2,{id:"ansible-roles",children:"Ansible Roles"}),"\n",(0,i.jsx)(n.p,{children:"Ansible Roles are a way to organize and reuse automation code in a structured, modular format."}),"\n",(0,i.jsx)(n.p,{children:"A role groups related Ansible content \u2014 tasks, handlers, templates, files, and variables \u2014 into a single, self-contained directory. This makes playbooks cleaner, easier to maintain, and reusable across multiple projects."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"roles/\n  nginx/\n    tasks/\n      main.yml\n    handlers/\n      main.yml\n    templates/\n      nginx.conf.j2\n    vars/\n      main.yml\n"})}),"\n",(0,i.jsx)(n.h2,{id:"installing-ansible-roles",children:"Installing Ansible Roles"}),"\n",(0,i.jsxs)(n.p,{children:["Fetch and install all required Ansible roles from the ",(0,i.jsx)(n.em,{children:"requirements.yml"})," file before running any playbooks."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Runs inside a Docker container specified by ",(0,i.jsx)(n.em,{children:"ansibleDockerImage"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Uses a Bitbucket SSH key (retrieved securely via Vault) for authentication when fetching private roles or repositories."}),"\n",(0,i.jsx)(n.li,{children:"Installs roles using:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ansible-galaxy install -p playbooks/roles -r requirements.yml\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ANSIBLE_LOCAL_TEMP"})," is set to ",(0,i.jsx)(n.em,{children:"$[WORKSPACE]/.ansible"})," to define a temporary working directory for Ansible operations."]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Ensures all required roles are locally available in ",(0,i.jsx)(n.em,{children:"playbooks/roles/"})," before any playbook execution."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"prepare-ssh-key-for-ansible",children:"Prepare SSH Key for Ansible"}),"\n",(0,i.jsx)(n.p,{children:"Make a Jenkins SSH private key available for Ansible to establish SSH connections with managed nodes.\nCopies the Jenkins agent's SSH private key to the workspace:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"install -m 600 /home/jenkins/.ssh/id_rsa ${WORKSPACE}/jenkins_id_rsa\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Provides the private key (",(0,i.jsx)(n.em,{children:"jenkins_id_rsa"}),") that will later be used by Ansible for host authentication."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"execute-ansible-playbook",children:"Execute Ansible Playbook"}),"\n",(0,i.jsx)(n.p,{children:"Run the main Ansible playbook using the previously installed roles and configured SSH key."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Executes within the same Ansible Docker image (",(0,i.jsx)(n.em,{children:"ansibleDockerImage"}),") for consistency."]}),"\n",(0,i.jsxs)(n.li,{children:["Runs the main playbook ",(0,i.jsx)(n.em,{children:"playbooks/main.yml"})," with elevated privileges (",(0,i.jsx)(n.code,{children:"-b"})," flag)."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ansible-playbook -i ${ansibleInventoryPath} \\\n  --private-key ../jenkins_id_rsa \\\n  -u jenkins \\\n  -b \\\n  playbooks/main.yml \\\n  -e 'WORKSPACE=${WORKSPACE}' \\\n  -e 'clamav_token=${env.CLAMAV_FLOCK_TOKEN}'\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Executes the infrastructure automation defined in main.yml.\nPasses necessary runtime variables for environment-specific configurations."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>t});var l=s(6540);const i={},a=l.createContext(i);function r(e){const n=l.useContext(a);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),l.createElement(a.Provider,{value:n},e.children)}}}]);