"use strict";(self.webpackChunktech_notes=self.webpackChunktech_notes||[]).push([[8639],{5258:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"linux/ssh/ssh","title":"SSH","description":"\u0421\u0430\u043c\u044b\u0439 \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u0441\u043f\u043e\u0441\u043e\u0431 \u0437\u0430\u0439\u0442\u0438 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440:","source":"@site/docs/linux/ssh/ssh.md","sourceDirName":"linux/ssh","slug":"/linux/ssh/","permalink":"/linux/ssh/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"File System","permalink":"/linux/file-system"},"next":{"title":"/etc/krb5.conf","permalink":"/linux/ssh/krb5.conf"}}');var r=s(4848),a=s(8453);const c={sidebar_position:3},o="SSH",t={},l=[{value:"\u041c\u0435\u0441\u0442\u043e, \u0433\u0434\u0435 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u043a\u043e\u043d\u0444\u0438\u0433 SSH",id:"\u043c\u0435\u0441\u0442\u043e-\u0433\u0434\u0435-\u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f-\u043a\u043e\u043d\u0444\u0438\u0433-ssh",level:2},{value:"\u041b\u043e\u0433\u0438\u043d \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u043e\u0433\u043e \u043a\u043b\u044e\u0447\u0430, \u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c\u0430 \u0438 \u0445\u043e\u0441\u0442\u0430",id:"\u043b\u043e\u0433\u0438\u043d-\u0441-\u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c-\u043f\u0440\u0438\u0432\u0430\u0442\u043d\u043e\u0433\u043e-\u043a\u043b\u044e\u0447\u0430-\u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c\u0430-\u0438-\u0445\u043e\u0441\u0442\u0430",level:2},{value:"\u041b\u043e\u0433\u0438\u043d \u043f\u043e\u0434 \u0440\u0443\u0442\u043e\u043c \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c \u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c\u0430",id:"\u043b\u043e\u0433\u0438\u043d-\u043f\u043e\u0434-\u0440\u0443\u0442\u043e\u043c-\u0441-\u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c-\u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c\u0430",level:2},{value:"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u043f\u0443\u0431\u043b\u0438\u0447\u043d\u043e\u0433\u043e \u043a\u043b\u044e\u0447\u0430 \u0438\u0437 \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u043e\u0433\u043e \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430",id:"\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435-\u043f\u0443\u0431\u043b\u0438\u0447\u043d\u043e\u0433\u043e-\u043a\u043b\u044e\u0447\u0430-\u0438\u0437-\u043f\u0440\u0438\u0432\u0430\u0442\u043d\u043e\u0433\u043e-\u0441-\u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c-\u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430",level:2},{value:"SSH and Git connectivity",id:"ssh-and-git-connectivity",level:2},{value:"UNPROTECTED PRIVATE KEY FILE",id:"unprotected-private-key-file",level:2},{value:"Script Timeout and Disconnection",id:"script-timeout-and-disconnection",level:2},{value:"SSH Config",id:"ssh-config",level:2}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"ssh",children:"SSH"})}),"\n",(0,r.jsx)(n.p,{children:"\u0421\u0430\u043c\u044b\u0439 \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u0441\u043f\u043e\u0441\u043e\u0431 \u0437\u0430\u0439\u0442\u0438 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh andriibondariev@10.20.100.200\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u0427\u0443\u0442\u044c \u043f\u043e-\u0441\u043b\u043e\u0436\u043d\u0435\u0435:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh -l andriibondariev@prod.example.com 10.20.100.200\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"scp -r /* root@10.20.100.200:/usr/lib/zabbix/externalscripts\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u0438\u043b\u0438"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"scp -i myAmazonKey.pem script.sh ubuntu@3.135.180.100:/\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u043c\u0435\u0441\u0442\u043e-\u0433\u0434\u0435-\u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f-\u043a\u043e\u043d\u0444\u0438\u0433-ssh",children:"\u041c\u0435\u0441\u0442\u043e, \u0433\u0434\u0435 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u043a\u043e\u043d\u0444\u0438\u0433 SSH"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"/etc/ssh/ssh_config\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u043b\u043e\u0433\u0438\u043d-\u0441-\u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c-\u043f\u0440\u0438\u0432\u0430\u0442\u043d\u043e\u0433\u043e-\u043a\u043b\u044e\u0447\u0430-\u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c\u0430-\u0438-\u0445\u043e\u0441\u0442\u0430",children:"\u041b\u043e\u0433\u0438\u043d \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u043e\u0433\u043e \u043a\u043b\u044e\u0447\u0430, \u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c\u0430 \u0438 \u0445\u043e\u0441\u0442\u0430"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh -i ~/.ssh/my_key -l myusername 10.20.100.200\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u043b\u043e\u0433\u0438\u043d-\u043f\u043e\u0434-\u0440\u0443\u0442\u043e\u043c-\u0441-\u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c-\u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c\u0430",children:"\u041b\u043e\u0433\u0438\u043d \u043f\u043e\u0434 \u0440\u0443\u0442\u043e\u043c \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c \u044e\u0437\u0435\u0440\u043d\u0435\u0439\u043c\u0430"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh -i andriibondariev root@10.20.134.204\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435-\u043f\u0443\u0431\u043b\u0438\u0447\u043d\u043e\u0433\u043e-\u043a\u043b\u044e\u0447\u0430-\u0438\u0437-\u043f\u0440\u0438\u0432\u0430\u0442\u043d\u043e\u0433\u043e-\u0441-\u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c-\u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430",children:"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u043f\u0443\u0431\u043b\u0438\u0447\u043d\u043e\u0433\u043e \u043a\u043b\u044e\u0447\u0430 \u0438\u0437 \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u043e\u0433\u043e \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'ssh-keygen -y -f /path/to/your/private/key -C "new-comment" > new_public_key.pub\n'})}),"\n",(0,r.jsx)(n.h2,{id:"ssh-and-git-connectivity",children:"SSH and Git connectivity"}),"\n",(0,r.jsx)(n.p,{children:"\u0421\u043e\u0437\u0434\u0430\u0439\u0442\u0435 \u043a\u043b\u044e\u0447 SSH: \u0435\u0441\u043b\u0438 \u0443 \u0432\u0430\u0441 \u0435\u0449\u0435 \u043d\u0435\u0442 \u043a\u043b\u044e\u0447\u0430 SSH \u0438\u043b\u0438 \u0432\u044b \u0445\u043e\u0442\u0438\u0442\u0435 \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0434\u043b\u044f \u044d\u0442\u043e\u0439 \u0446\u0435\u043b\u0438."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'ssh-keygen -t rsa -b 4096 -C "andrii.bondariev@example.com"\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u0423\u043a\u0430\u0436\u0438\u0442\u0435 \u043c\u0435\u0441\u0442\u043e\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0432\u043e \u0432\u0440\u0435\u043c\u044f \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438 \u043a\u043b\u044e\u0447\u0430:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"/c/Users/AndreasDesktop/.ssh/example\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 Public Key \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440 Git:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cat /c/Users/AndreasDesktop/.ssh/example.pub\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u0423\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e ssh-\u0430\u0433\u0435\u043d\u0442 \u0437\u0430\u043f\u0443\u0449\u0435\u043d:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"eval $(ssh-agent -s)\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsx)(n.p,{children:"\u041d\u0430 Windows \u044d\u0442\u043e \u0432\u044b\u0433\u043b\u044f\u0434\u0438\u0442 \u0442\u0430\u043a:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ps",children:"Get-Service ssh-agent | Set-Service -StartupType Manual\n"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ps",children:"Start-Service ssh-agent\n"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ps",children:"ssh-add C:\\path\\to\\your\\ssh\\private\\key\n"})})]}),"\n",(0,r.jsx)(n.p,{children:"\u0421\u043f\u0438\u0441\u043e\u043a \u043a\u043b\u044e\u0447\u0435\u0439 \u0430\u0433\u0435\u043d\u0442\u0430 SSH:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh-add -L\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u0423\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e \u0432\u0430\u0448 \u043a\u043b\u044e\u0447 example \u0443\u043a\u0430\u0437\u0430\u043d \u0432 \u0441\u043f\u0438\u0441\u043a\u0435. \u0415\u0441\u043b\u0438 \u043d\u0435\u0442, \u0434\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh-add /c/Users/AndreasDesktop/.ssh/example\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043f\u0440\u044f\u043c\u043e\u0435 SSH-\u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh -T git@git.example.net\n"})}),"\n",(0,r.jsx)(n.h2,{id:"unprotected-private-key-file",children:"UNPROTECTED PRIVATE KEY FILE"}),"\n",(0,r.jsxs)(n.p,{children:["Only the owner can ",(0,r.jsx)(n.code,{children:"read"})," the file (most secure):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"chmod 400 /mnt/c/Users/AndreasDesktop/.ssh/example\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Owner can ",(0,r.jsx)(n.code,{children:"read"})," and ",(0,r.jsx)(n.code,{children:"write"})," (also acceptable):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"chmod 600 /mnt/c/Users/AndreasDesktop/.ssh/example\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsxs)(n.p,{children:["If you're running this on ",(0,r.jsx)(n.strong,{children:"WSL"})," (Windows Subsystem for Linux) or ",(0,r.jsx)(n.strong,{children:"Git Bash"})," on Windows, where permission changes via ",(0,r.jsx)(n.code,{children:"chmod"})," might not fully apply due to the underlying ",(0,r.jsx)(n.strong,{children:"NTFS"})," file system."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cp /mnt/c/Users/AndreasDesktop/.ssh/namecheap ~/.ssh/\n"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"chmod 400 ~/.ssh/namecheap\n"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh-add ~/.ssh/namecheap\n"})}),(0,r.jsxs)(n.p,{children:["Files in ",(0,r.jsx)(n.code,{children:"/mnt/c/..."})," are controlled by Windows, and Windows ignores Unix-style permissions like ",(0,r.jsx)(n.code,{children:"chmod 400"}),"."]})]}),"\n",(0,r.jsx)(n.h2,{id:"script-timeout-and-disconnection",children:"Script Timeout and Disconnection"}),"\n",(0,r.jsx)(n.p,{children:'The message "client_loop: send disconnect: Broken pipe" typically indicates that the SSH connection to your server is timing out while your script is still running. This often happens with long-running processes in environments where there\'s a timeout on idle SSH connections.\nSolutions:'}),"\n",(0,r.jsx)(n.p,{children:'Prevent SSH Timeout: You can prevent the SSH session from timing out by sending a "keep alive" signal at regular intervals. This can be done by setting the following options in your SSH configuration (~/.ssh/config):'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"Host *\n    ServerAliveInterval 60\n    ServerAliveCountMax 120\n"})}),"\n",(0,r.jsx)(n.p,{children:"This configuration sends a keep-alive message every 60 seconds and allows up to 120 missed messages before disconnecting."}),"\n",(0,r.jsx)(n.p,{children:"Using screen or tmux: These tools allow you to run sessions that continue even if you disconnect or log out from the SSH session. Start a screen or tmux session before running your script, which you can then detach from and reattach to later."}),"\n",(0,r.jsx)(n.h2,{id:"ssh-config",children:"SSH Config"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"Include /etc/ssh/ssh_config.d/*.conf\nHost *\nSendEnv LANG LC_*\n    HashKnownHosts yes\n    GSSAPIAuthentication yes\n\nHost jump *jump-host-name*\n    HostName *jump-host-name*\n    User username@corporation\n    IdentityFile ~/.ssh/aduser\n    #Add connection multiplexing\n    ControlMaster auto\n    ControlPath ~/.ssh/%u@%h:%p\n    ControlPersist 10m\n \nHost !jump !*jump-host-name* *\n    # some settings\n    # some settings\n    ProxyJump jump\n\n\nHost *host-name*\n    ProxyJump jump\n    HostName *ip-address*\n    User username@corporation\n    IdentityFile /root/.ssh/aduser\n\n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>o});var i=s(6540);const r={},a=i.createContext(r);function c(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);