"use strict";(self.webpackChunktech_notes=self.webpackChunktech_notes||[]).push([[4303],{8123:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"linux/install","title":"Install Debian","description":"Restart the VM","source":"@site/docs/linux/install.md","sourceDirName":"linux","slug":"/linux/install","permalink":"/linux/install","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"crontab","permalink":"/linux/crontab"},"next":{"title":"Root FAQ","permalink":"/linux/root"}}');var i=n(4848),r=n(8453);const a={},t="Install Debian",d={},c=[{value:"Restart the VM",id:"restart-the-vm",level:2},{value:"Begin the Debian Installer (Text Mode)",id:"begin-the-debian-installer-text-mode",level:2},{value:"Partitioning",id:"partitioning",level:2},{value:"Software Selection",id:"software-selection",level:2},{value:"Install GRUB to /dev/sda when prompted",id:"install-grub-to-devsda-when-prompted",level:2},{value:"Test Network and SSH",id:"test-network-and-ssh",level:2},{value:"To disable the CD-ROM as a package source, and allow apt to download packages from online mirrors.",id:"to-disable-the-cd-rom-as-a-package-source-and-allow-apt-to-download-packages-from-online-mirrors",level:2},{value:"Refresh the package list",id:"refresh-the-package-list",level:3},{value:"Install Required Packages",id:"install-required-packages",level:2},{value:"SSH + AD Setup",id:"ssh--ad-setup",level:2},{value:"Adjust Permissions",id:"adjust-permissions",level:3},{value:"Rejoin the domain",id:"rejoin-the-domain",level:3},{value:"Restart Services",id:"restart-services",level:3},{value:"To remove or disable the local user to avoid confusion, and keep only the AD user.",id:"to-remove-or-disable-the-local-user-to-avoid-confusion-and-keep-only-the-ad-user",level:3},{value:"Ansible",id:"ansible",level:2},{value:"Make a Git connectivity",id:"make-a-git-connectivity",level:3},{value:"Create requirements.yml",id:"create-requirementsyml",level:3},{value:"Install the role",id:"install-the-role",level:3},{value:"Create Your Playbook",id:"create-your-playbook",level:3},{value:"Create Inventory",id:"create-inventory",level:3},{value:"Run the Playbook",id:"run-the-playbook",level:3}];function o(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"install-debian",children:"Install Debian"})}),"\n",(0,i.jsx)(s.h2,{id:"restart-the-vm",children:"Restart the VM"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Power off the VM"}),"\n",(0,i.jsx)(s.li,{children:"Edit the VM \u2192 Mount the Debian netinst ISO (e.g. debian-12.x.x-amd64-netinst.iso)"}),"\n",(0,i.jsx)(s.li,{children:"Set the VM to boot from CD/DVD first (in the VM's boot options)"}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"begin-the-debian-installer-text-mode",children:"Begin the Debian Installer (Text Mode)"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Select ",(0,i.jsx)(s.code,{children:"\u201cInstall\u201d"})," or \u201cGraphical Install\u201d \u2014 (use server version)"]}),"\n",(0,i.jsx)(s.li,{children:"Go through the steps:"}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Language"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Locale"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Keyboard"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Hostname: ",(0,i.jsx)(s.code,{children:"<HOST_NAME>"})," # like a VM name"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Leave domain name empty or set to something like ",(0,i.jsx)(s.code,{children:"corp.example.net"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Create ",(0,i.jsx)(s.code,{children:"root"})," or admin user"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"partitioning",children:"Partitioning"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.code,{children:"Guided \u2013 use entire disk \u2192 All files in one partition"})}),"\n",(0,i.jsx)(s.h2,{id:"software-selection",children:"Software Selection"}),"\n",(0,i.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Debian desktop environment"]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",checked:!0,disabled:!0})," ","standard system utilities"]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",checked:!0,disabled:!0})," ","SSH server"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"install-grub-to-devsda-when-prompted",children:"Install GRUB to /dev/sda when prompted"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.code,{children:"Confirm GRUB install \u2192 select /dev/sda when asked"})}),"\n",(0,i.jsx)(s.h2,{id:"test-network-and-ssh",children:"Test Network and SSH"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ip a\n"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ip addr show\n"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"systemctl status ssh\n"})}),"\n",(0,i.jsx)(s.h2,{id:"to-disable-the-cd-rom-as-a-package-source-and-allow-apt-to-download-packages-from-online-mirrors",children:"To disable the CD-ROM as a package source, and allow apt to download packages from online mirrors."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"nano /etc/apt/sources.list\n"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-plaintext",children:"deb http://deb.debian.org/debian bookworm main contrib non-free non-free-firmware\ndeb http://security.debian.org/debian-security bookworm-security main contrib non-free non-free-firmware\ndeb http://deb.debian.org/debian bookworm-updates main contrib non-free non-free-firmware\n"})}),"\n",(0,i.jsx)(s.h3,{id:"refresh-the-package-list",children:"Refresh the package list"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"apt update\n"})}),"\n",(0,i.jsx)(s.h2,{id:"install-required-packages",children:"Install Required Packages"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"apt install -y realmd sssd sssd-tools sshpass adcli krb5-user libnss-sss libpam-sss samba-common-bin packagekit git ansible curl\n"})}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Package"}),(0,i.jsx)(s.th,{children:"Purpose"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"realmd"}),(0,i.jsx)(s.td,{children:"Joins Linux machine to Active Directory"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"sssd"}),(0,i.jsx)(s.td,{children:"Handles authentication and caching"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"sshpass"}),(0,i.jsxs)(s.td,{children:["Ansible uses SSH when ",(0,i.jsx)(s.code,{children:"--ask-pass"})," used"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"adcli"}),(0,i.jsx)(s.td,{children:"Assists joining AD domains"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"krb5-user"}),(0,i.jsx)(s.td,{children:"Kerberos support (authentication to domain)"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"libnss-sss, libpam-sss"}),(0,i.jsx)(s.td,{children:"Allows Linux to resolve AD users and groups"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"samba-common-bin"}),(0,i.jsx)(s.td,{children:"Provides tools needed for domain joining"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"git"}),(0,i.jsx)(s.td,{children:"To work with git repositories"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"ansible"}),(0,i.jsx)(s.td,{children:"This will install ansible, ansible-galaxy, ansible-playbook and other necessary tools"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"curl"}),(0,i.jsx)(s.td,{children:"to make http requests"})]})]})]}),"\n",(0,i.jsx)(s.h2,{id:"ssh--ad-setup",children:"SSH + AD Setup"}),"\n",(0,i.jsx)(s.p,{children:"After previous instructions need to fill next configurations from examples:"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"File Name"}),(0,i.jsx)(s.th,{children:"Purpose"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"/etc/krb5.conf"}),(0,i.jsx)(s.td,{children:"Kerberos config (for authentication to AD)"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"/etc/sssd/sssd.conf"}),(0,i.jsx)(s.td,{children:"SSSD configuration (for user/group access)"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"/etc/ssh/sshd_config (only specific parts)"}),(0,i.jsx)(s.td,{children:"SSH settings (restrictions, login rules)"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"/etc/sudoers.d/ files (specific to AD groups)"}),(0,i.jsx)(s.td,{children:"Sudo permissions for AD groups/users"})]})]})]}),"\n",(0,i.jsx)(s.h3,{id:"adjust-permissions",children:"Adjust Permissions"}),"\n",(0,i.jsxs)(s.p,{children:["Especially for ",(0,i.jsx)(s.code,{children:"sssd.conf"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"chmod 600 /etc/sssd/sssd.conf\n"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"chown root:root /etc/sssd/sssd.conf\n"})}),"\n",(0,i.jsx)(s.h3,{id:"rejoin-the-domain",children:"Rejoin the domain"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"realm leave corp.example.net\n"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"realm join --user=andriibondariev corp.example.net\n"})}),"\n",(0,i.jsx)(s.h3,{id:"restart-services",children:"Restart Services"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"systemctl restart sssd\n"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"systemctl restart ssh\n"})}),"\n",(0,i.jsx)(s.h3,{id:"to-remove-or-disable-the-local-user-to-avoid-confusion-and-keep-only-the-ad-user",children:"To remove or disable the local user to avoid confusion, and keep only the AD user."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"getent passwd andriibondariev\n"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Disable:"}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"usermod -L andriibondariev\n"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Delete:"}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"deluser andriibondariev\n"})}),"\n",(0,i.jsx)(s.h2,{id:"ansible",children:"Ansible"}),"\n",(0,i.jsx)(s.h3,{id:"make-a-git-connectivity",children:"Make a Git connectivity"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"eval $(ssh-agent -s)\n"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ssh-add /c/Users/AndreasDesktop/.ssh/example\n"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"chmod 600 /root/.ssh/example\n"})}),"\n",(0,i.jsx)(s.h3,{id:"create-requirementsyml",children:"Create requirements.yml"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"---\n- src: git+ssh://git@git.example.net/sre/ansible-role-jenkins_agent.git\n  version: master\n"})}),"\n",(0,i.jsx)(s.h3,{id:"install-the-role",children:"Install the role"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ansible-galaxy install -r requirements.yml -p roles\n"})}),"\n",(0,i.jsx)(s.h3,{id:"create-your-playbook",children:"Create Your Playbook"}),"\n",(0,i.jsxs)(s.p,{children:["Create a file ",(0,i.jsx)(s.code,{children:"install-jenkins-agent.yml"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"---\n- name: Install Jenkins Agent Dependencies\n  hosts: jenkins_agents\n  gather_facts: yes\n  become: true\n\n  roles:\n    - ansible-role-jenkins_agent\n"})}),"\n",(0,i.jsx)(s.h3,{id:"create-inventory",children:"Create Inventory"}),"\n",(0,i.jsxs)(s.p,{children:["Create a file ",(0,i.jsx)(s.code,{children:"inventory.ini"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"[jenkins_agents]\nphx01-sre-sps-01 ansible_host=<IP> ansible_user=andriibondariev\n"})}),"\n",(0,i.jsx)(s.h3,{id:"run-the-playbook",children:"Run the Playbook"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ansible-playbook -i inventory.ini install-jenkins-agent.yml --ask-pass\n"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash"})})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>t});var l=n(6540);const i={},r=l.createContext(i);function a(e){const s=l.useContext(r);return l.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),l.createElement(r.Provider,{value:s},e.children)}}}]);